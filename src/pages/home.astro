---
import Layout from '../layouts/Layout.astro';
import ReleaseCard from '../components/ReleaseCard.astro';
import ComponentsStyles from '../styles/ComponentsStyles.astro';

import releases from '../data/releases.json';
import tourData from '../data/tour.json';
import TourCard from '../components/TourCard.astro';

interface TourItem {
    id: number;
    date: string;
    venue: string;
    city: string;
    title: string;
    flyer: string;
    ticketPrice?: string;
    reserve?: string;
}

const tour = tourData as unknown as TourItem[];
const latestRelease = releases[0];
const base = import.meta.env.BASE_URL;
---
<script>
    document.addEventListener('DOMContentLoaded', () => {
        const banner = document.querySelector('.banner');

        if (banner) {
            // Removed blur-related JavaScript code
        }
    });
</script>

<Layout>
    <ComponentsStyles />
    <section class="hero section fade-in-up">
        <!-- 一番目立たせたい連絡など -->
        <div class="banner">
            <span class="highlight">1st EP</span> 『<span class="italic">Carte Vierge</span>』 <span class="highlight release">4/29 Release</span>
        </div>
        <img
            class="header-img"
            src={`${base}images/top.JPG`}
            alt="ヘッダー画像"
        />
    </section>

    <section class="latest-release section fade-in-left">
        <h2>Latest Release</h2>
        {latestRelease && (
            <div class="release-content">
                <ReleaseCard
                    id={latestRelease.id}
                    title={latestRelease.title}
                    cover={latestRelease.cover}
                    releaseDate={latestRelease.releaseDate}
                    tracks={latestRelease.tracks}
                    links={latestRelease.links}
                />
            </div>
        )}
    </section>

    <section class="next-live section fade-in-left">
        <h2>Next Live</h2>
        {tour.length > 0 ? (
            <div class="tour-list">
                {(() => {
                    const nextTour = tour.find((item) => item.id === 1);
                    return nextTour ? (
                        <TourCard tour={nextTour} />
                    ) : (
                        <p class="tour-empty">現在予定されているライブはありません。</p>
                    );
                })()}
            </div>
        ) : (
            <p class="tour-empty">現在予定されているライブはありません。</p>
        )}
    </section>
</Layout>

<style>
.hero {
    margin-top: 0;
    margin-bottom: var(--spacing-xl);
}

.hero h1 {
    font-size: clamp(2rem, 5vw, 3rem);
    margin-top: var(--spacing-md);
    margin-bottom: var(--spacing-md);
    text-align: center;
    color: var(--color-primary);
}

.banner {
    background-image: linear-gradient(45deg, var(--color-accent), var(--color-primary-accent)); /* グラデーション背景 */
    background-color: var(--color-bg); 
    color: var(--color-text-on-accent); /* 背景色に映える文字色 */
    padding: var(--spacing-md) var(--spacing-lg); /* 少しパディングを大きく */
    border-radius: var(--radius-md); /* 角丸を少し大きく */
    text-align: center;
    margin-bottom: var(--spacing-lg); /* マージンを調整 */
    box-shadow: var(--shadow-xl); /* より強い影 */
    font-size: clamp(1.8rem, 4vw, 2.5rem); /* h1より少し小さめ */
    font-weight: bold;
    text-shadow: 1px 1px 2px rgba(0,0,0,0.2); /* テキストシャドウ */
    opacity: 0; /* アニメーション開始前の初期状態は透明 */
    /* アニメーションのプロパティを更新 */
    animation: banner-load-animation 3.5s ease-in-out forwards;
    position: relative; /* z-index を有効にするため */
    z-index: 1000;    /* ぼかしレイヤーより手前に表示 */
    will-change: transform, opacity; /* 追加: アニメーションのヒント */
}

.banner .highlight {
    color: var(--color-primary-accent); /* 強調部分の色 */
}

.banner .italic {
    font-style: italic;
}


.italic {
    font-style: italic;
}

.release {
    display: inline-block; /* インラインブロック要素として表示 */
}

.hero .header-img {
    width: 80%;
    max-width: 1000px;
    height: auto;
    display: block;
    margin: var(--spacing-md) auto var(--spacing-xl);
    border-radius: var(--radius-base);
    box-shadow: var(--shadow-base);
}

.section h2 {
    font-size: clamp(1.5rem, 3vw, 2rem);
    margin-top: var(--spacing-md);
    margin-bottom: var(--spacing-md);
    text-align: center;
}

@keyframes banner-load-animation {
  0% {
    opacity: 1; /* アニメーション開始時に表示 */
    /* 要素自身の高さを考慮して垂直中央に配置し、1.25倍に拡大 */
    transform: translateY(50vh) translateY(-50%) scale(1.25);
  }
  /* アニメーション総時間3.5秒のうち、最初の2秒間この状態を維持 (2s / 3.5s ≒ 57%) */
  57% {
    opacity: 1;
    transform: translateY(50vh) translateY(-50%) scale(1.25);
  }
  /* 残りの1.5秒で元の位置と大きさに戻る */
  100% {
    opacity: 1;
    transform: translateY(0) scale(1);
  }
}

/* Removed body::before and body.blur-active::before styles */

@media (max-width: 768px) {
    .hero {
        margin-bottom: var(--spacing-md);
        padding: 0 var(--spacing-md);
    }

    .hero h1 {
        margin: var(--spacing-sm) 0;
        line-height: 1.5;
    }

    .banner {
        font-size: clamp(1.5rem, 5vw, 2rem);
        padding: var(--spacing-xs) var(--spacing-sm);
    }

    .banner .release {
        display: block; /* 小さい画面では改行させる */
        margin-left: 0;
        margin-top: var(--spacing-xs);
        font-size: clamp(1rem, 3vw, 1.5rem);
    }

    .hero .header-img {
        max-width: 100%;
        margin: var(--spacing-md) auto var(--spacing-lg);
    }

    .release {
        display: block; /* 小さい画面では改行させる */
        margin-top: var(--spacing-xs);
    }
}
</style>
