---  
import TrackList from './TrackList.astro'; 
import '../styles/components.css';
import { getImagePath } from '../utils/paths.js';

export interface Props {  
    id: number;  
    title: string;  
    cover: string;  
    releaseDate: string;  
    tracks: string[];  

    /** 各ストリーミングサービスへのURL */
    links?: {
        youtube?: string;
        subscription?: string;
    };
}  

const { title, cover, releaseDate, tracks, links} = Astro.props;
// カバー画像のパスを共通関数で処理
const coverPath = cover.startsWith('http') ? cover : getImagePath(cover);
---  
<article class="release-card">  
    <img  
        class="release-cover"  
        src={coverPath}  
        alt={`${title} Cover`}  
        loading="lazy"
    />  
    <div class="release-info">  
        <h3 class="release-title">{title}</h3>  
        <time  
            class="release-date"  
            datetime={releaseDate}  
        >  
            {new Date(releaseDate).toLocaleDateString('ja-JP', {  
                year: 'numeric',  
                month: 'long',  
                day: 'numeric'  
            })}  
        </time>  
        <TrackList tracks={tracks} />  
        
        {links && links.subscription && (
            <p class="subscription-note">各種サブスクリプションサービスで配信中</p>
        )}
        
        {links && (
            <div class="subscription-links">
                {links.youtube && (
                <a href={links.youtube} target="_blank" rel="noopener" class="sub-link button">
                    YouTubeで聴く
                </a>
                )}
                {links.subscription && (
                <a href={links.subscription} target="_blank" rel="noopener" class="sub-link button">
                    サブスクリプションで聴く
                </a>
                )}
            </div>
        )}
    </div>  
</article>
